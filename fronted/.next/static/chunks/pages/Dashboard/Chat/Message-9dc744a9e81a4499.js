(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3157],{960:(e,s,r)=>{"use strict";r.d(s,{A:()=>i});var t=r(7876),a=r(4232),l=r(1777),n=r(829),c=r(5362);function i(e){let{receiverId:s,receiverType:r,currentUserId:i,currentUserType:o}=e,d=(0,a.useContext)(n.d),u=(0,l.wA)(),{messages:h,conversationId:m,loading:f,error:g}=(0,l.d4)(e=>e.message),[x,p]=(0,a.useState)(""),v=(0,a.useRef)(null);(0,a.useEffect)(()=>{i&&s&&u((0,c.p5)({participant1:i,participant2:s}))},[u,i,s]),(0,a.useEffect)(()=>{if(!d)return;let e=e=>{(e.senderId===s&&e.receiverId===i||e.senderId===i&&e.receiverId===s)&&u((0,c.tj)(e))},r=e=>{let{messageId:s}=e;u((0,c.lg)({messageId:s,status:"delivered"}))},t=e=>{let{messageIds:s}=e;u((0,c.iS)({messageIds:s}))};return d.on("newMessage",e),d.on("messageDelivered",r),d.on("messageRead",t),()=>{d.off("newMessage",e),d.off("messageDelivered",r),d.off("messageRead",t)}},[d,s,i,u]),(0,a.useEffect)(()=>{var e;null==(e=v.current)||e.scrollIntoView({behavior:"smooth"})},[h]),(0,a.useEffect)(()=>{if(!d||!h||0===h.length)return;let e=h.filter(e=>e.senderId===s&&e.receiverId===i&&"seen"!==e.status);console.log("Total unread messages:",e),e.length>0&&(d.emit("readMessages",{senderId:s,receiverId:i}),console.log("Sent readMessages event to socket for",s,"->",i))},[h,d,s,i,u]);let N=()=>{""!==x.trim()&&(d.emit("sendMessage",{senderId:i,receiverId:s,senderType:o,receiverType:r,message:x.trim()}),p(""))},w=Array.isArray(h)?h.filter(e=>e.senderId===s&&e.receiverId===i||e.senderId===i&&e.receiverId===s):[];return(0,t.jsxs)("div",{className:"border p-4 rounded shadow",children:[(0,t.jsxs)("div",{className:"h-64 overflow-y-auto bg-gray-100 p-2 mb-2",children:[0===w.length?(0,t.jsx)("div",{children:"No messages yet"}):w.map(e=>(0,t.jsx)("div",{className:"mb-1 ".concat(e.senderId===i?"text-right":"text-left"),children:(0,t.jsxs)("span",{className:"inline-block bg-white p-1 rounded shadow",children:["string"==typeof e.message?e.message:e.message&&"object"==typeof e.message&&e.message.message?e.message.message:JSON.stringify(e.message),"sent"===e.status&&(0,t.jsx)("span",{className:"text-xs ml-1",children:"✔"}),"delivered"===e.status&&(0,t.jsx)("span",{className:"text-xs ml-1",children:"✔✔"}),"seen"===e.status&&(0,t.jsx)("span",{className:"text-xs text-amber-700 ml-1",children:"✔t✔"})]})},e._id)),(0,t.jsx)("div",{ref:v})]}),(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("input",{className:"flex-1 border p-1 rounded-l",value:x,onChange:e=>p(e.target.value),placeholder:"Type a message...",onKeyDown:e=>{"Enter"===e.key&&N()}}),(0,t.jsx)("button",{className:"bg-blue-500 text-white px-4 rounded-r",onClick:N,children:"Send"})]})]})}},1580:(e,s,r)=>{"use strict";r.d(s,{A:()=>t});let t=(0,r(1713).A)("circle-user",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]])},1713:(e,s,r)=>{"use strict";r.d(s,{A:()=>u});var t=r(4232);let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,s,r)=>r?r.toUpperCase():s.toLowerCase()),n=e=>{let s=l(e);return s.charAt(0).toUpperCase()+s.slice(1)},c=function(){for(var e=arguments.length,s=Array(e),r=0;r<e;r++)s[r]=arguments[r];return s.filter((e,s,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===s).join(" ").trim()},i=e=>{for(let s in e)if(s.startsWith("aria-")||"role"===s||"title"===s)return!0};var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let d=(0,t.forwardRef)((e,s)=>{let{color:r="currentColor",size:a=24,strokeWidth:l=2,absoluteStrokeWidth:n,className:d="",children:u,iconNode:h,...m}=e;return(0,t.createElement)("svg",{ref:s,...o,width:a,height:a,stroke:r,strokeWidth:n?24*Number(l)/Number(a):l,className:c("lucide",d),...!u&&!i(m)&&{"aria-hidden":"true"},...m},[...h.map(e=>{let[s,r]=e;return(0,t.createElement)(s,r)}),...Array.isArray(u)?u:[u]])}),u=(e,s)=>{let r=(0,t.forwardRef)((r,l)=>{let{className:i,...o}=r;return(0,t.createElement)(d,{ref:l,iconNode:s,className:c("lucide-".concat(a(n(e))),"lucide-".concat(e),i),...o})});return r.displayName=n(e),r}},3082:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>d});var t=r(7876),a=r(4232),l=r(1777),n=r(2842),c=r(829);r(9099);var i=r(1580),o=r(960);function d(){let e=(0,l.wA)(),{teachers:s,loading:r}=(0,l.d4)(e=>e.teacher),{schoolInfo:d}=(0,l.d4)(e=>e.schoolLogin),[u,h]=(0,a.useState)(null),[m,f]=(0,a.useState)(null),g=(0,a.useContext)(c.d),[x,p]=(0,a.useState)({});console.log("teacher at school dasdh board",s),(0,a.useEffect)(()=>{e((0,n.x0)())},[e]),(0,a.useEffect)(()=>{f(d)},[d]),(0,a.useEffect)(()=>(g&&g.on("onlineStatus",e=>{let{userId:s,status:r}=e;console.log("Received onlineStatus:",s,r),p(e=>({...e,[s]:"online"===r}))}),()=>{g&&g.off("onlineStatus")}),[g]);let v=e=>{console.log("Teacher clicked:",e),e?h(e):console.log("No teacher selected")};return(0,a.useEffect)(()=>{console.log("Selected teacher changed:",u)},[u]),(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"School Dashboard"}),r?(0,t.jsx)("p",{children:"Loading teachers..."}):(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"Teachers"}),(0,t.jsx)("div",{className:"flex overflow-x-auto space-x-4 pb-4",children:s.map(e=>(0,t.jsxs)("div",{className:"flex flex-col items-center cursor-pointer hover:scale-105 transition",onClick:()=>v(e),children:[(0,t.jsx)("div",{className:"w-16 h-16 rounded-full border-4 ".concat(x[e._id]?"border-green-500":"border-red-500"," flex items-center justify-center bg-gray-100"),children:(0,t.jsx)(i.A,{className:"w-12 h-12 text-gray-500"})}),(0,t.jsx)("span",{className:"mt-1 text-sm text-center",children:e.firstName})]},e._id))})]}),u&&(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsxs)("h2",{className:"text-lg font-semibold",children:["Chat with ",u.firstName]}),(0,t.jsx)(o.A,{receiverId:u._id,receiverType:"Teacher",currentUserId:d.school.id,currentUserType:"School"})]})]})}},7620:(e,s,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/Dashboard/Chat/Message",function(){return r(3082)}])}},e=>{var s=s=>e(e.s=s);e.O(0,[636,6593,8792],()=>s(7620)),_N_E=e.O()}]);